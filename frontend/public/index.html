<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM v2 - Sistema de Gest√£o Dom√©stica</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }
        #root {
            width: 100%;
            height: 100vh;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            Carregando DOM v2...
        </div>
    </div>
    
    <script>
        // Mostrar loading fallback se React Native Web falhar
        window.addEventListener('load', function() {
            console.log('DOM v2 - Carregando aplica√ß√£o React Native...');
            
            // Aguardar um tempo para o React Native Web carregar
            setTimeout(function() {
                const rootElement = document.getElementById('root');
                const loadingElement = document.getElementById('loading-fallback');
                
                // Se o root ainda estiver vazio, mostrar loading
                if (rootElement && rootElement.children.length === 0) {
                    loadingElement.style.display = 'flex';
                }
            }, 3000); // 3 segundos de timeout
        });
    </script>
    
    <!-- Polyfills para React Native Web -->
    <script>
        // Interceptar erros antes de qualquer coisa
        window.addEventListener('error', function(event) {
            if (event.error && event.error.message && event.error.message.includes('DevSettings')) {
                console.log('üõ°Ô∏è Interceptando erro DevSettings - aplicando polyfill...');
                event.preventDefault();
                
                // Aplicar polyfills imediatamente
                if (!window.DevSettings) {
                    window.DevSettings = {
                        addMenuItem: () => {},
                        reload: () => {},
                        setHotLoadingEnabled: () => {},
                        setIsShakeToShowDevMenuEnabled: () => {}
                    };
                }
                
                if (!window.TurboModuleRegistry) {
                    window.TurboModuleRegistry = {
                        getEnforcing: (name) => {
                            if (name === 'DevSettings') {
                                return window.DevSettings;
                            }
                            return {};
                        },
                        get: (name) => {
                            if (name === 'DevSettings') {
                                return window.DevSettings;
                            }
                            return null;
                        }
                    };
                }
                
                console.log('‚úÖ Polyfills aplicados ap√≥s intercepta√ß√£o');
                return false;
            }
        });
        
        // Configurar React Native Web para web
        window.__fbBatchedBridgeConfig = {
            remoteModuleConfig: [],
            localModuleConfig: []
        };
        
        // Polyfills necess√°rios
        if (typeof global === 'undefined') {
            window.global = window;
        }
        
        if (typeof process === 'undefined') {
            window.process = { env: { NODE_ENV: 'development' } };
        }
        
        // Mockar m√≥dulos nativos problem√°ticos
        window.DevSettings = {
            addMenuItem: () => {},
            reload: () => {},
            setHotLoadingEnabled: () => {},
            setIsShakeToShowDevMenuEnabled: () => {}
        };
        
        window.NativeModules = {
            DevSettings: window.DevSettings
        };
        
        window.NativeEventEmitter = class {
            constructor() {}
            addListener() { return { remove: () => {} }; }
            removeAllListeners() {}
            emit() {}
        };
        
        // Configurar TurboModuleRegistry
        window.TurboModuleRegistry = {
            getEnforcing: (name) => {
                if (name === 'DevSettings') {
                    return window.DevSettings;
                }
                return {};
            },
            get: (name) => {
                if (name === 'DevSettings') {
                    return window.DevSettings;
                }
                return null;
            }
        };
        
        console.log('‚úÖ Polyfills carregados com sucesso');
    </script>
    
    <!-- Bundle do React Native Web -->
    <script src="http://localhost:8081/index.bundle?platform=web&dev=true"></script>
    
    <!-- Script para for√ßar inicializa√ß√£o -->
    <script>
        // Aguardar o bundle carregar e for√ßar inicializa√ß√£o
        window.addEventListener('load', function() {
            console.log('üîÑ Aguardando React Native Web carregar...');
            
            setTimeout(function() {
                // Verificar se o React Native Web foi inicializado
                const rootElement = document.getElementById('root');
                const loadingElement = rootElement.querySelector('.loading');
                
                if (rootElement && rootElement.children.length === 1 && loadingElement) {
                    console.log('‚ö†Ô∏è React Native Web n√£o inicializou automaticamente');
                    console.log('üîÑ Tentando inicializa√ß√£o manual...');
                    
                    // Tentar inicializar manualmente
                    if (window.AppRegistry) {
                        try {
                            // Remover mensagem de carregamento
                            if (loadingElement) {
                                loadingElement.remove();
                            }
                            
                            window.AppRegistry.runApplication('FrontendApp', { 
                                rootTag: rootElement 
                            });
                            console.log('‚úÖ Inicializa√ß√£o manual bem-sucedida!');
                        } catch (error) {
                            console.error('‚ùå Erro na inicializa√ß√£o manual:', error);
                        }
                    } else {
                        console.error('‚ùå AppRegistry n√£o encontrado');
                        console.log('üîç Tentando carregar bundle novamente...');
                        
                        // Tentar carregar o bundle novamente
                        const script = document.createElement('script');
                        script.src = 'http://localhost:8081/index.bundle?platform=web&dev=true';
                        script.onload = function() {
                            console.log('‚úÖ Bundle recarregado');
                            if (window.AppRegistry) {
                                try {
                                    if (loadingElement) {
                                        loadingElement.remove();
                                    }
                                    window.AppRegistry.runApplication('FrontendApp', { 
                                        rootTag: rootElement 
                                    });
                                    console.log('‚úÖ Inicializa√ß√£o bem-sucedida ap√≥s recarregamento!');
                                } catch (error) {
                                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                                }
                            }
                        };
                        document.head.appendChild(script);
                    }
                } else {
                    console.log('‚úÖ React Native Web j√° inicializado!');
                }
            }, 3000); // Aumentado para 3 segundos
        });
    </script>
</body>
</html> 